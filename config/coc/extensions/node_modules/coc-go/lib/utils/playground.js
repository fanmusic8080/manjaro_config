"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const coc_nvim_1 = require("coc.nvim");
const child_process_1 = require("child_process");
const tools_1 = require("./tools");
const binaries_1 = require("../binaries");
function openPlayground(document) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        return runGoplay(document.getText());
    });
}
exports.openPlayground = openPlayground;
function runGoplay(code) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const bin = yield tools_1.goBinPath(binaries_1.GOPLAY);
        if (!(yield tools_1.commandExists(bin))) {
            yield tools_1.installGoBin(binaries_1.GOPLAY);
        }
        return new Promise((resolve, reject) => {
            const p = child_process_1.execFile(bin, ['-'], {}, (err, stdout, stderr) => tslib_1.__awaiter(this, void 0, void 0, function* () {
                coc_nvim_1.workspace.showMessage(stdout);
                if (err) {
                    coc_nvim_1.workspace.showMessage(`${stderr}`, "error");
                    return reject(err);
                }
                resolve(true);
            }));
            if (p.pid) {
                p.stdin.end(code);
            }
        });
    });
}
//# sourceMappingURL=playground.js.map